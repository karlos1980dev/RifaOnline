<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Visualizador da Rifa</title>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #2980b9, #6dd5fa);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
    text-align: center;
  }

  #container {
    max-width: 400px;
    width: 100%;
  }

  h1 {
    margin-bottom: 30px;
    font-weight: 700;
    font-size: 2rem;
    text-shadow: 0 0 8px rgba(0,0,0,0.3);
  }

  .linha {
    margin-bottom: 18px;
  }

  .label {
    font-weight: 600;
    font-size: 1rem;
    color: #000;
    display: block;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 1.2px;
  }

  .value {
    font-size: 1.3rem;
    font-weight: 700;
    word-wrap: break-word;
  }

  /* Status colors */
  .status-ganhou {
    color: #27ae60; /* verde */
  }

  .status-perdeu {
    color: #e74c3c; /* vermelho */
  }

  .status-cancelou {
    color: #2980b9; /* azul */
  }

  .status-aguardando {
    color: #f1c40f; /* amarelo */
  }

  #message {
    font-size: 1.2rem;
    color: #ffd700;
    margin-top: 20px;
  }
</style>
</head>
<body>

<div id="container">
  <h1>Visualizador da Rifa</h1>

  <div id="resultado" style="display:none;">
    <div class="linha">
      <span class="label">Código</span>
      <span class="value" id="codigoValor"></span>
    </div>
    <div class="linha">
      <span class="label">Data e Hora</span>
      <span class="value" id="dataHoraValor"></span>
    </div>
    <div class="linha">
      <span class="label">Nome</span>
      <span class="value" id="nomeValor"></span>
    </div>
     <div class="linha">
      <span class="label">Horário</span>
      <span class="value" id="horarioValor"></span>
    </div>
    <div class="linha">
      <span class="label">Números</span>
      <span class="value" id="numerosValor"></span>
    </div>
   
    
    <div class="linha">
      <span class="label">Status</span>
      <span class="value status-aguardando" id="statusValor">Aguardando resultado</span>
    </div>
  </div>

  <div id="message"></div>
</div>

<script>
  // Configuração Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCIDFHMmzGkN3HGLn-XA8ieC_5DDBvbJ7o",
    authDomain: "rifa-782a3.firebaseapp.com",
    databaseURL: "https://rifa-782a3-default-rtdb.firebaseio.com",
    projectId: "rifa-782a3",
    storageBucket: "rifa-782a3.firebasestorage.app",
    messagingSenderId: "88068598855",
    appId: "1:88068598855:web:a230a06db6a4bbc125562"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const codigoValor = document.getElementById("codigoValor");
  const nomeValor = document.getElementById("nomeValor");
  const numerosValor = document.getElementById("numerosValor");
  const horarioValor = document.getElementById("horarioValor");
  const dataHoraValor = document.getElementById("dataHoraValor");
  const statusValor = document.getElementById("statusValor");
  const resultadoDiv = document.getElementById("resultado");
  const messageDiv = document.getElementById("message");

  // Função para pegar parâmetro da URL
  function getParametro(nome) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(nome);
  }

  function atualizarStatus(texto) {
    statusValor.textContent = texto;
    statusValor.classList.remove("status-ganhou", "status-perdeu", "status-cancelou", "status-aguardando");
    texto = texto.toLowerCase();
    if (texto.includes("ganhou")) {
      statusValor.classList.add("status-ganhou");
    } else if (texto.includes("perdeu")) {
      statusValor.classList.add("status-perdeu");
    } else if (texto.includes("cancelou")) {
      statusValor.classList.add("status-cancelou");
    } else {
      statusValor.classList.add("status-aguardando");
    }
  }

  const codigoParam = getParametro("codigo");

  if (!codigoParam) {
    messageDiv.textContent = "Nenhum código informado na URL.";
  } else {
    messageDiv.textContent = "Carregando...";
    db.ref("compras-dia").once("value").then(snapshot => {
      let encontrado = null;
      let horarioEncontrado = "";

      snapshot.forEach(diaSnap => {
        diaSnap.forEach(horarioSnap => {
          horarioSnap.forEach(reservaSnap => {
            const dados = reservaSnap.val();
            if (dados.codigo === codigoParam) {
              encontrado = dados;
              horarioEncontrado = horarioSnap.key;
              return true;
            }
          });
          if (encontrado) return true;
        });
        if (encontrado) return true;
      });

      if (encontrado) {
        codigoValor.textContent = encontrado.codigo;
        nomeValor.textContent = encontrado.nome;
        numerosValor.textContent = encontrado.numeros.join(", ");
        horarioValor.textContent = horarioEncontrado;
        dataHoraValor.textContent = encontrado.dataHora;
        // Usa o status vindo do banco, ou padrão "Aguardando resultado"
        if (encontrado.status) {
          atualizarStatus(encontrado.status);
        } else {
          atualizarStatus("Aguardando resultado");
        }
        resultadoDiv.style.display = "block";
        messageDiv.textContent = "";
      } else {
        messageDiv.textContent = "Código não encontrado.";
        resultadoDiv.style.display = "none";
      }
    }).catch(err => {
      messageDiv.textContent = "Erro ao buscar dados: " + err;
      resultadoDiv.style.display = "none";
    });
  }
</script>

</body>
        </html>
